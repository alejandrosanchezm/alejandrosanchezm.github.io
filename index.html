<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amigo Invisible</title>
</head>
<body>
    <h1>Amigo Invisible</h1>
    <p id="resultado">Cargando...</p>

    <script>
        const encodedDataURL = "data_encrypted.txt";

        // Función para obtener el parámetro 'token' de la URL
        function getTokenFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get("token");
        }

        async function getEncodedData() {
            const response = await fetch(encodedDataURL);
            return await response.text();
        }

        function decodeBase64ToJSON(encodedData) {
            const decodedData = atob(encodedData);
            return JSON.parse(decodedData);
        }

        async function mostrarAmigo() {
            const token = getTokenFromURL();
            const encodedData = await getEncodedData();
            const participantes = decodeBase64ToJSON(encodedData);

            const participante = participantes.find(p => p.token === token);
            const resultado = document.getElementById("resultado");

            if (participante) {
                resultado.textContent = `Hola ${participante.user}, debes regalar a ${participante.has_to_gift}.`;
            } else {
                resultado.textContent = "Token no válido o no encontrado.";
            }
        }

        // Llama a la función cuando se carga la página
        mostrarAmigo();
    </script>
</body>
</html>
