class CVApp{constructor(){this.cvData=null,this.currentLanguage="es",this.init()}async init(){try{this.initializeTheme(),await this.loadData(),this.renderContent(),this.setupEventListeners(),this.setupScrollAnimations(),this.setupActiveNavigation(),this.setupHiddenFeatures(),this.setupPrivacyConsent(),this.notifyContentLoaded()}catch(t){this.showError("Error al cargar los datos del CV")}}notifyContentLoaded(){window.languageManager&&setTimeout(()=>{window.languageManager.onCVContentLoaded()},50)}async loadData(){try{if(window.CV_DATA)this.cvData=window.CV_DATA;else{const t=await fetch("data/cv-data.json");if(!t.ok)throw Error("HTTP error! status: "+t.status);this.cvData=await t.json()}}catch(t){throw t}}setLanguage(t){this.currentLanguage=t,this.updateCVDataForLanguage()}updateCVDataForLanguage(){window.languageManager&&(this.cvData=window.languageManager.getTranslatedCVData())}getTranslation(t){return window.languageManager?window.languageManager.getTranslation(t):t}renderContent(){this.cvData&&(this.renderPersonalInfo(),this.renderSummary(),this.renderSpecialties(),this.renderExperience(),this.renderSkills(),this.renderEducation(),this.renderProjects(),this.renderCertifications(),this.renderLanguages())}renderPersonalInfo(){const t=this.cvData.personalInfo,e=document.getElementById("header");e&&t&&(e.innerHTML=`\n                <div class="header-section text-white p-8 mb-8 fade-in">\n                    <div class="flex flex-col lg:flex-row items-center gap-8 relative z-10">\n                        <div class="slide-in-left">\n                            <img src="${t.photo}" alt="${t.name}" \n                                 class="profile-image object-cover">\n                        </div>\n                        <div class="text-center lg:text-left slide-in-right">\n                            <h1 class="text-5xl font-bold mb-3">${t.name}</h1>\n                            <h2 class="text-2xl text-blue-100 mb-6 font-light">${t.title}</h2>\n                            <div class="flex flex-wrap justify-center lg:justify-start gap-3">\n                                <span class="contact-link">\n                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">\n                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>\n                                    </svg>\n                                    ${t.location}\n                                </span>\n                                <a href="mailto:${t.email}" class="contact-link">\n                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">\n                                        <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>\n                                        <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>\n                                    </svg>\n                                    ${t.email}\n                                </a>\n                                <span class="contact-link">\n                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">\n                                        <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>\n                                    </svg>\n                                    ${t.phone}\n                                </span>\n                                <a href="https://${t.linkedin}" target="_blank" class="contact-link">\n                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">\n                                        <path fill-rule="evenodd" d="M16.338 16.338H13.67V12.16c0-.995-.017-2.277-1.387-2.277-1.39 0-1.601 1.086-1.601 2.207v4.248H8.014v-8.59h2.559v1.174h.037c.356-.675 1.227-1.387 2.526-1.387 2.703 0 3.203 1.778 3.203 4.092v4.711zM5.005 6.575a1.548 1.548 0 11-.003-3.096 1.548 1.548 0 01.003 3.096zm-1.337 9.763H6.34v-8.59H3.667v8.59zM17.668 1H2.328C1.595 1 1 1.581 1 2.298v15.403C1 18.418 1.595 19 2.328 19h15.34c.734 0 1.332-.582 1.332-1.299V2.298C19 1.581 18.402 1 17.668 1z" clip-rule="evenodd"/>\n                                    </svg>\n                                    LinkedIn\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `)}renderSummary(){const t=document.getElementById("summaryContainer");t&&this.cvData.summary&&(t.innerHTML=`\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 hover:shadow-xl transition-all duration-300 slide-up">\n                    <h2 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6 pb-4 border-b border-gray-200 dark:border-gray-700">${this.getTranslation("about")}</h2>\n                    <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">${this.cvData.summary}</p>\n                </div>\n            `)}renderSpecialties(){const t=document.getElementById("specialtiesContainer");if(!t||!this.cvData.specialties)return;const e=this.cvData.specialties.map((t,e)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 slide-up" style="animation-delay: ${.1*e}s">\n                <div class="text-center">\n                    <div class="w-16 h-16 bg-${t.color}-100 dark:bg-${t.color}-900 rounded-full flex items-center justify-center mx-auto mb-4">\n                        <i class="${t.icon} text-${t.color}-600 dark:text-${t.color}-400 text-2xl"></i>\n                    </div>\n                    <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-3">${t.title}</h3>\n                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4 leading-relaxed">${t.description}</p>\n                    <div class="flex flex-wrap justify-center gap-1">\n                        ${t.technologies.map(t=>`\n                            <span class="inline-block bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-1 rounded text-xs font-medium">\n                                ${t}\n                            </span>\n                        `).join("")}\n                    </div>\n                </div>\n            </div>\n        `).join("");t.innerHTML=e}renderProjects(){const t=document.getElementById("projectsContainer");if(!t||!this.cvData.projects)return;const e=this.cvData.projects.map((t,e)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 sm:p-6 hover:shadow-xl transition-all duration-300 slide-up" style="animation-delay: ${.1*e}s">\n                <div class="flex flex-col sm:flex-row sm:items-start gap-4">\n                    ${t.image?`\n                        <img src="${t.image}" alt="${t.title}" class="w-16 h-16 rounded-lg object-cover shadow-md flex-shrink-0 self-center sm:self-start">\n                    `:'\n                        <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0 self-center sm:self-start">\n                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">\n                                <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd"/>\n                            </svg>\n                        </div>\n                    '}\n                    <div class="flex-1 min-w-0">\n                        <div class="flex flex-col sm:flex-row sm:items-start gap-2 mb-3">\n                            <h3 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 leading-tight">${t.title}</h3>\n                            ${t.type?`<span class="project-type-chip inline-block bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap self-start" title="${t.type}">${t.type}</span>`:""}\n                        </div>\n                        <p class="text-gray-600 dark:text-gray-300 mb-4 text-sm sm:text-base leading-relaxed">${t.description}</p>\n                        ${t.technologies&&t.technologies.length>0?`\n                            <div class="flex flex-wrap gap-2 mb-4">\n                                ${t.technologies.map(t=>`\n                                    <span class="tech-badge text-xs">${t}</span>\n                                `).join("")}\n                            </div>\n                        `:""}\n                        ${t.link?`\n                            <a href="${t.link}" target="_blank" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium text-sm">\n                                Ver proyecto\n                                <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20">\n                                    <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>\n                                </svg>\n                            </a>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `).join("");t.innerHTML=e}calculateDuration(t,e=null){const n=e?new Date(e):new Date,s=new Date(t);let i=n.getFullYear()-s.getFullYear(),a=n.getMonth()-s.getMonth();0>a&&(i--,a+=12);let r="";return i>0&&(r+=`${i} año${i>1?"s":""}`),a>0&&(r&&(r+=" "),r+=`${a} mes${a>1?"es":""}`),r||"1 mes"}parseDurationString(t){const e=t.match(/(\w{3}\.\s\d{4})\s-\s(.+?)(?:\s·|$)/);if(!e)return t;const n=e[1],s=e[2],i={ene:0,feb:1,mar:2,abr:3,may:4,jun:5,jul:6,ago:7,sep:8,oct:9,nov:10,dic:11},a=n.match(/(\w{3})\.\s(\d{4})/);if(!a)return t;const r=i[a[1]],o=parseInt(a[2]),l=new Date(o,r,1);let d=null;if("actualidad"!==s){const t=s.match(/(\w{3})\.\s(\d{4})/);if(t){const e=i[t[1]],n=parseInt(t[2]);d=new Date(n,e+1,0)}}return`${n} - ${"actualidad"===s?"actualidad":s} · ${this.calculateDuration(l,d)}`}renderExperience(){const t=document.getElementById("experienceContainer");if(!t||!this.cvData.experience)return;const e=this.cvData.experience.filter(t=>"software"===t.category),n=this.cvData.experience.filter(t=>"other"===t.category),s=e.map((t,e)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 border-blue-500 hover:shadow-xl transition-all duration-300 mb-6 slide-up" style="animation-delay: ${.1*e}s">\n                <div class="flex flex-col md:flex-row md:items-start space-y-4 md:space-y-0 md:space-x-6">\n                    <div class="flex-shrink-0">\n                        ${t.logo?`\n                            <img src="${t.logo}" alt="${t.company}" class="w-16 h-16 rounded-lg object-cover shadow-md" \n                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">\n                            <div class="w-16 h-16 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-2xl shadow-md hidden">\n                                <i class="fas fa-building text-gray-500 dark:text-gray-300"></i>\n                            </div>\n                        `:'\n                            <div class="w-16 h-16 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-2xl shadow-md">\n                                <i class="fas fa-building text-gray-500 dark:text-gray-300"></i>\n                            </div>\n                        '}\n                    </div>\n                    <div class="flex-1">\n                        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3">\n                            <div>\n                                <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">${t.position}</h3>\n                                <p class="text-lg text-blue-600 dark:text-blue-400 font-semibold">${t.company}</p>\n                                ${t.sector?`<p class="text-sm text-purple-600 dark:text-purple-400 font-medium">${t.sector}</p>`:""}\n                            </div>\n                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-1 md:mt-0 md:text-right">\n                                <p>${this.parseDurationString(t.duration)}</p>\n                                <p>${t.location}</p>\n                                <span class="inline-block bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full text-xs font-medium mt-1">\n                                    ${t.type}\n                                </span>\n                            </div>\n                        </div>\n                        <p class="text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">${t.description}</p>\n                        \n                        ${t.careerProgression?`\n                            <div class="mb-4 bg-gray-50 dark:bg-gray-700 rounded-lg p-4">\n                                <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center">\n                                    <i class="fas fa-chart-line text-blue-500 dark:text-blue-400 mr-2"></i>\n                                    Progresión Profesional\n                                </h4>\n                                ${t.careerProgression.map(t=>`\n                                    <div class="mb-3 last:mb-0">\n                                        <p class="text-sm text-gray-700 dark:text-gray-300 leading-relaxed">\n                                            <strong class="text-gray-900 dark:text-gray-100">${t.role}</strong> <span class="text-gray-500 dark:text-gray-400">(${t.period})</span>: ${t.responsibilities}\n                                        </p>\n                                    </div>\n                                `).join("")}\n                            </div>\n                        `:t.keyTasks?`\n                            <div class="mb-4">\n                                <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200 mb-2 flex items-center">\n                                    <i class="fas fa-tasks text-green-500 dark:text-green-400 mr-2"></i>\n                                    Tareas Clave\n                                </h4>\n                                <div class="flex flex-wrap gap-1">\n                                    ${t.keyTasks.map(t=>`\n                                        <span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full">${t}</span>\n                                    `).join("")}\n                                </div>\n                            </div>\n                        `:""}\n                        \n                        ${t.technologies&&t.technologies.length>0?`\n                            <div class="flex flex-wrap gap-2">\n                                ${t.technologies.map(t=>`\n                                    <span class="tech-badge tech-clickable" data-tech="${t.toLowerCase()}">${t}</span>\n                                `).join("")}\n                            </div>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `).join(""),i=n.length>0?`\n            <div class="text-center mt-8">\n                <button id="toggleOtherExperiences" class="bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 border border-gray-200 dark:border-gray-600 px-6 py-3 rounded-lg transition-colors duration-300 flex items-center mx-auto space-x-2">\n                    <i class="fas fa-plus" id="toggleIcon"></i>\n                    <span id="toggleText">${this.getTranslation("viewNonSoftwareExperience")}</span>\n                </button>\n            </div>\n        `:"",a=n.map((t,n)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border-l-4 border-green-500 hover:shadow-xl transition-all duration-300 mb-6 slide-up other-experience hidden" style="animation-delay: ${.1*(e.length+n)}s">\n                <div class="flex flex-col md:flex-row md:items-start space-y-4 md:space-y-0 md:space-x-6">\n                    <div class="flex-shrink-0">\n                        ${t.logo?`\n                            <img src="${t.logo}" alt="${t.company}" class="w-16 h-16 rounded-lg object-cover shadow-md" \n                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">\n                            <div class="w-16 h-16 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-2xl shadow-md hidden">\n                                <i class="fas fa-user-tie text-gray-500 dark:text-gray-300"></i>\n                            </div>\n                        `:'\n                            <div class="w-16 h-16 rounded-lg bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-2xl shadow-md">\n                                <i class="fas fa-chalkboard-teacher text-gray-500 dark:text-gray-300"></i>\n                            </div>\n                        '}\n                    </div>\n                    <div class="flex-1">\n                        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-3">\n                            <div>\n                                <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">${t.position}</h3>\n                                <p class="text-lg text-blue-600 dark:text-blue-400 font-semibold">${t.company}</p>\n                                ${t.sector?`<p class="text-sm text-purple-600 dark:text-purple-400 font-medium">${t.sector}</p>`:""}\n                            </div>\n                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-1 md:mt-0 md:text-right">\n                                <p>${this.parseDurationString(t.duration)}</p>\n                                <p>${t.location}</p>\n                                <span class="inline-block bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full text-xs font-medium mt-1">\n                                    ${t.type}\n                                </span>\n                            </div>\n                        </div>\n                        <p class="text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">${t.description}</p>\n                        ${t.technologies&&t.technologies.length>0?`\n                            <div class="flex flex-wrap gap-2">\n                                ${t.technologies.map(t=>`\n                                    <span class="tech-badge tech-clickable" data-tech="${t.toLowerCase()}">${t}</span>\n                                `).join("")}\n                            </div>\n                        `:""}\n                    </div>\n                </div>\n            </div>\n        `).join("");t.innerHTML=s+i+a,this.setupExperienceToggle(),this.setupTechClickEvents()}renderSkills(){const t=document.getElementById("skillsContainer");if(!t||!this.cvData.skills)return;const e=[{key:"backend",title:this.getTranslation("backendAPIs"),icon:"fas fa-server",color:"blue"},{key:"frontend",title:this.getTranslation("frontendUI"),icon:"fas fa-laptop-code",color:"green"},{key:"mobile",title:this.getTranslation("mobile"),icon:"fas fa-mobile-alt",color:"purple"},{key:"databases",title:this.getTranslation("databases"),icon:"fas fa-database",color:"red"},{key:"bigData",title:this.getTranslation("bigData"),icon:"fas fa-chart-bar",color:"orange"},{key:"infrastructure",title:this.getTranslation("infrastructure"),icon:"fas fa-cloud",color:"yellow"},{key:"dataScience",title:this.getTranslation("dataScience"),icon:"fas fa-chart-line",color:"indigo"},{key:"tools",title:this.getTranslation("tools"),icon:"fas fa-toolbox",color:"gray"}].map((t,e)=>{const n=this.cvData.skills[t.key];return n&&0!==n.length?`\n                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover-lift slide-up transition-colors duration-300" style="animation-delay: ${.1*e}s">\n                    <div class="flex items-center mb-4">\n                        <div class="w-12 h-12 bg-${t.color}-100 rounded-lg flex items-center justify-center mr-4">\n                            <i class="${t.icon} text-${t.color}-600 text-xl"></i>\n                        </div>\n                        <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">${t.title}</h3>\n                    </div>\n                    <div class="space-y-3">\n                        ${n.map(t=>`\n                            <div class="flex items-center justify-between">\n                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">${"string"==typeof t?t:t.name}</span>\n                                <div class="flex items-center space-x-1">\n                                    ${this.renderSkillLevel("string"==typeof t?3:t.level)}\n                                </div>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            `:""}).join("");t.innerHTML=e}renderEducation(){const t=document.getElementById("educationContainer");if(!t||!this.cvData.education)return;const e=this.cvData.education.map((t,e)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 mb-6 slide-up" style="animation-delay: ${.1*e}s">\n                <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-6">\n                    <div class="flex-shrink-0">\n                        <img src="${t.logo}" alt="${t.institution}" class="w-16 h-16 rounded-lg object-cover shadow-md"\n                             onerror="this.src='images/profile.jpeg'; this.onerror=null;">\n                    </div>\n                    <div class="flex-1">\n                        <div class="flex flex-col md:flex-row md:items-center md:justify-between">\n                            <div>\n                                <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">${t.degree}</h3>\n                                <p class="text-lg text-blue-600 dark:text-blue-400 font-semibold">${t.institution}</p>\n                                ${t.note?`<span class="inline-block bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded-full text-xs font-medium mt-2">${t.note}</span>`:""}\n                            </div>\n                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-2 md:mt-0 md:text-right">\n                                <p>${t.duration}</p>\n                                <p>${t.location}</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `).join("");t.innerHTML=e}renderCertifications(){const t=document.getElementById("certificationsContainer");if(!t||!this.cvData.certifications)return;const e=this.cvData.certifications.map((t,e)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 mb-6 slide-up" style="animation-delay: ${.1*e}s">\n                <div class="flex flex-col md:flex-row md:items-start space-y-4 md:space-y-0 md:space-x-6">\n                    <div class="flex-shrink-0">\n                        <img src="${t.logo}" alt="${t.issuer}" class="w-16 h-16 rounded-lg object-cover shadow-md"\n                             onerror="this.src='images/profile.jpeg'; this.onerror=null;">\n                    </div>\n                    <div class="flex-1">\n                        <div class="flex flex-col md:flex-row md:items-start md:justify-between mb-3">\n                            <div class="flex-1">\n                                <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-1">${t.title}</h3>\n                                <p class="text-lg text-blue-600 dark:text-blue-400 font-semibold mb-2">${t.issuer}</p>\n                                ${t.description?`<p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">${t.description}</p>`:""}\n                            </div>\n                            <div class="text-sm text-gray-500 dark:text-gray-400 mt-2 md:mt-0 md:text-right">\n                                <div class="flex items-center space-x-2">\n                                    <i class="fas fa-certificate text-yellow-500 dark:text-yellow-400"></i>\n                                    <span class="font-medium">${t.date}</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `).join("");t.innerHTML=e}renderLanguages(){const t=document.getElementById("languagesContainer");if(!t||!this.cvData.languages)return;const e=this.cvData.languages.map((t,e)=>`\n            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover:shadow-xl transition-all duration-300 slide-up" style="animation-delay: ${.1*e}s">\n                <div class="flex items-center mb-4">\n                    <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mr-4">\n                        <i class="fas fa-language text-blue-600 dark:text-blue-400 text-xl"></i>\n                    </div>\n                    <div class="flex-1">\n                        <h3 class="text-lg font-bold text-gray-900 dark:text-gray-100">${t.language}</h3>\n                        <p class="text-sm text-gray-600 dark:text-gray-300">${t.level}</p>\n                    </div>\n                </div>\n                <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">\n                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 dark:from-blue-400 dark:to-blue-500 h-2 rounded-full transition-all duration-1000 ease-out" \n                         style="width: ${t.proficiency}%"></div>\n                </div>\n                <div class="text-right mt-2">\n                    <span class="text-xs text-gray-500 dark:text-gray-400">${t.proficiency}%</span>\n                </div>\n            </div>\n        `).join("");t.innerHTML=e}setupExperienceToggle(){const t=document.getElementById("toggleOtherExperiences"),e=document.getElementById("toggleIcon"),n=document.getElementById("toggleText"),s=document.querySelectorAll(".other-experience");if(!t)return;let i=!1;t.addEventListener("click",()=>{i=!i,s.forEach((t,e)=>{i?setTimeout(()=>{t.classList.remove("hidden"),t.classList.add("slide-up")},100*e):(t.classList.add("hidden"),t.classList.remove("slide-up"))}),i?(e.className="fas fa-minus",n.textContent=this.getTranslation("hideNonSoftwareExperience"),t.classList.remove("bg-gray-100","hover:bg-gray-200","dark:bg-gray-700","dark:hover:bg-gray-600","text-gray-700","dark:text-gray-200","border-gray-200","dark:border-gray-600"),t.classList.add("bg-blue-100","hover:bg-blue-200","dark:bg-blue-900","dark:hover:bg-blue-800","text-blue-800","dark:text-blue-200","border-blue-200","dark:border-blue-700")):(e.className="fas fa-plus",n.textContent=this.getTranslation("viewNonSoftwareExperience"),t.classList.remove("bg-blue-100","hover:bg-blue-200","dark:bg-blue-900","dark:hover:bg-blue-800","text-blue-800","dark:text-blue-200","border-blue-200","dark:border-blue-700"),t.classList.add("bg-gray-100","hover:bg-gray-200","dark:bg-gray-700","dark:hover:bg-gray-600","text-gray-700","dark:text-gray-200","border-gray-200","dark:border-gray-600"))})}setupTechClickEvents(){document.querySelectorAll(".tech-clickable").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=t.getAttribute("data-tech"),s=document.getElementById("skills");if(s){const t=document.querySelector("nav"),e=t?t.offsetHeight:80,i=s.getBoundingClientRect().top+window.pageYOffset-e-20;window.scrollTo({top:i,behavior:"smooth"}),this.highlightTechInSkills(n)}})})}highlightTechInSkills(t){setTimeout(()=>{const e=document.getElementById("skillsContainer");e&&e.querySelectorAll(".text-sm").forEach(e=>{e.textContent.toLowerCase().includes(t.toLowerCase())&&(e.classList.add("highlight-tech"),setTimeout(()=>{e.classList.remove("highlight-tech")},2e3))})},500)}renderSkillLevel(t){let e="";for(let n=1;5>=n;n++)e+=n>t?'<div class="w-3 h-3 border-2 border-blue-300 rounded-full"></div>':'<div class="w-3 h-3 bg-blue-500 rounded-full"></div>';return e}setupEventListeners(){document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=document.querySelector(t.getAttribute("href"));if(n){const t=document.querySelector("nav"),e=t?t.offsetHeight:80,s=n.getBoundingClientRect().top+window.pageYOffset-e-20;window.scrollTo({top:s,behavior:"smooth"})}})});const t=document.getElementById("downloadPDF");t&&window.pdfGenerator&&t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),window.pdfGenerator.generatePDF()}),document.addEventListener("click",t=>{("sidebarToggle"===t.target.id||t.target.closest("#sidebarToggle"))&&(t.preventDefault(),1024>window.innerWidth?this.toggleMobileMenu():this.toggleSidebar())}),document.addEventListener("click",t=>{"sidebarOverlay"===t.target.id&&this.hideSidebar()}),document.querySelectorAll(".mobile-menu-link").forEach(t=>{t.addEventListener("click",this.hideMobileMenu.bind(this))});const e=document.getElementById("scrollToTop");e&&e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});const n=document.getElementById("themeToggle");n&&n.addEventListener("change",this.toggleTheme.bind(this)),document.addEventListener("keydown",t=>{"Escape"===t.key&&(this.hideMobileMenu(),this.hideSidebar())}),window.addEventListener("resize",()=>{this.hideMobileMenu(),this.hideSidebar()})}setupScrollAnimations(){const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&t.target.classList.add("fade-in")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".slide-up").forEach(e=>{t.observe(e)}),window.addEventListener("scroll",()=>{const t=document.querySelector("nav"),e=document.getElementById("scrollToTop");window.scrollY>100?(t.classList.add("shadow-lg"),e&&(e.classList.remove("opacity-0","pointer-events-none"),e.classList.add("opacity-100","pointer-events-auto"))):(t.classList.remove("shadow-lg"),e&&(e.classList.add("opacity-0","pointer-events-none"),e.classList.remove("opacity-100","pointer-events-auto")))})}toggleMobileMenu(){const t=document.getElementById("mobileMenu");t&&t.classList.toggle("hidden")}hideMobileMenu(){const t=document.getElementById("mobileMenu");t&&t.classList.add("hidden")}initializeTheme(){const t=localStorage.getItem("theme"),e=window.matchMedia("(prefers-color-scheme: dark)").matches;"dark"===t||!t&&e?(document.documentElement.classList.add("dark"),this.updateThemeToggle("dark")):(document.documentElement.classList.remove("dark"),this.updateThemeToggle("light")),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{localStorage.getItem("theme")||(t.matches?(document.documentElement.classList.add("dark"),this.updateThemeToggle("dark")):(document.documentElement.classList.remove("dark"),this.updateThemeToggle("light")))})}toggleTheme(){const t=document.getElementById("themeToggle"),e=document.documentElement.classList.contains("dark");t&&void 0!==t.checked?t.checked?(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light")):(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):e?(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"),this.updateThemeToggle("light")):(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark"),this.updateThemeToggle("dark"))}updateThemeToggle(t){const e=document.getElementById("themeToggle");e&&(e.checked="light"===t)}toggleSidebar(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebarOverlay");t&&e&&(t.classList.contains("show")?this.hideSidebar():this.showSidebar())}showSidebar(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebarOverlay");t&&e&&(t.classList.add("show"),e.classList.add("show"),document.body.style.overflow="hidden")}hideSidebar(){const t=document.getElementById("sidebar"),e=document.getElementById("sidebarOverlay");t&&e&&(t.classList.remove("show"),e.classList.remove("show"),document.body.style.overflow="")}setupActiveNavigation(){const t=document.querySelectorAll("section[id]"),e=document.querySelectorAll('.sidebar-item[href^="#"]'),n=()=>{let n="";const s=window.scrollY+150;if(t.forEach(t=>{const e=t.offsetTop,i=t.offsetHeight;s>=e&&e+i>s&&(n=t.getAttribute("id"))}),window.innerHeight+window.scrollY>=document.body.offsetHeight-100){const e=t[t.length-1];e&&(n=e.getAttribute("id"))}e.forEach(t=>{t.classList.remove("active"),t.getAttribute("href")==="#"+n&&t.classList.add("active")})};let s;n(),window.addEventListener("scroll",()=>{s&&clearTimeout(s),s=setTimeout(n,10)}),e.forEach(t=>{t.addEventListener("click",()=>{setTimeout(()=>{1024>window.innerWidth&&this.hideSidebar()},100)})})}showError(t){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50",e.innerHTML=`\n            <div class="flex items-center space-x-2">\n                <i class="fas fa-exclamation-circle"></i>\n                <span>${t}</span>\n                <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        `,document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},5e3)}showSuccess(t){const e=document.createElement("div");e.className="fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50",e.innerHTML=`\n            <div class="flex items-center space-x-2">\n                <i class="fas fa-check-circle"></i>\n                <span>${t}</span>\n                <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        `,document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},3e3)}setupHiddenFeatures(){const t=document.getElementById("unlockFeaturesBtn"),e=document.getElementById("unlockContainer"),n=document.getElementById("curiosities");t&&e&&n&&t.addEventListener("click",()=>{this.unlockHiddenFeatures(t,e,n)})}async unlockHiddenFeatures(t,e,n){t.disabled=!0,t.style.pointerEvents="none",e.style.transition="all 0.6s cubic-bezier(0.4, 0, 0.2, 1)",e.style.transform="translateY(-20px)",e.style.opacity="0",e.style.maxHeight=e.offsetHeight+"px",setTimeout(()=>{e.style.maxHeight="0",e.style.marginBottom="0",e.style.overflow="hidden"},300),setTimeout(()=>{this.showCuriositiesSection(n)},400)}async showCuriositiesSection(t){t.classList.remove("hidden"),t.style.transition="all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275)",t.offsetHeight,setTimeout(()=>{t.classList.remove("opacity-0","translate-y-8"),t.style.opacity="1",t.style.transform="translateY(0)"},50),this.createParticleEffect(),setTimeout(()=>{this.showSuccess("📊 Análisis comportamental activado. Los datos se procesan localmente y respetan tu privacidad.")},200),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})},800)}createParticleEffect(){const t=[],e=["#475569","#64748b","#334155","#1e293b"];for(let n=0;8>n;n++){const s=document.createElement("div");s.className="particle",s.style.cssText=`\n                position: fixed;\n                width: 4px;\n                height: 4px;\n                background: ${e[Math.floor(4*Math.random())]};\n                border-radius: 50%;\n                pointer-events: none;\n                z-index: 9999;\n                left: 50%;\n                top: 50%;\n                transform: translate(-50%, -50%);\n                animation: particleFloat 1.5s ease-out forwards;\n                opacity: 0.6;\n            `;const i=2*Math.PI*n/8,a=120+60*Math.random(),r=Math.cos(i)*a,o=Math.sin(i)*a;s.style.setProperty("--end-x",r+"px"),s.style.setProperty("--end-y",o+"px"),document.body.appendChild(s),t.push(s)}setTimeout(()=>{t.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)})},1500)}setupPrivacyConsent(){const t=document.getElementById("privacyBanner"),e=document.getElementById("acceptTracking"),n=document.getElementById("declineTracking");if(!t||!e||!n)return;const s=localStorage.getItem("trackingConsent");s?this.applyTrackingConsent("accepted"===s):setTimeout(()=>{this.showPrivacyBanner(t)},2e3),e.addEventListener("click",()=>{this.handleConsentChoice(!0,t)}),n.addEventListener("click",()=>{this.handleConsentChoice(!1,t)})}showPrivacyBanner(t){t.classList.remove("translate-y-full"),t.classList.add("translate-y-0")}hidePrivacyBanner(t){t.classList.add("translate-y-full"),t.classList.remove("translate-y-0"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},500)}handleConsentChoice(t,e){localStorage.setItem("trackingConsent",t?"accepted":"declined"),this.applyTrackingConsent(t),this.hidePrivacyBanner(e);const n=t?"✅ Análisis de comportamiento activado. Todos los datos se procesan localmente.":"🔒 Navegación privada activada. No se registrará ninguna interacción.";setTimeout(()=>{this.showSuccess(n)},300)}applyTrackingConsent(t){if(window.trackingConsent=t,t)window.activityTracker&&(window.activityTracker.consentGiven=!0,window.activityTracker.setupSectionTracking()),window.heatmapTracker&&(window.heatmapTracker.consentGiven=!0);else{window.activityTracker&&(window.activityTracker.consentGiven=!1,window.activityTracker.clearData()),window.heatmapTracker&&(window.heatmapTracker.consentGiven=!1,window.heatmapTracker.clearData());const e=document.getElementById("unlockContainer");e&&!t&&(e.style.display="none")}}}class ActivityTracker{constructor(){this.events=[],this.isActive=!0,this.isPageVisible=!0,this.stats={totalTimeOnPage:0,activeTime:0,inactiveTime:0,awayTime:0,totalInteractions:0,longestActiveStreak:0,longestInactiveStreak:0,averageSessionLength:0},this.lastActivity=Date.now(),this.sessionStart=Date.now(),this.inactivityTimer=null,this.currentStreak={type:"active",start:Date.now()},this.INACTIVITY_THRESHOLD=1e4,this.detailedHistoryVisible=!0,this.consentGiven=!1,this.sectionVisits=new Map,this.currentSection=null,this.sectionStartTime=null,this.userProfile={device:this.detectDevice(),browser:this.detectBrowser(),locale:this.detectLocale(),preferences:{theme:"auto",readingSpeed:0,engagementLevel:"medium"},behavior:{totalSessions:1,returningUser:!1,navigationPattern:[],favoriteSection:null,readingType:"unknown"}},this.init()}init(){this.setupPageVisibilityTracking(),this.setupInactivityTracking(),this.setupInteractionTracking(),this.setupSectionTracking(),this.startStatsUpdater(),this.addEvent({type:"page_focus",timestamp:Date.now(),details:{source:"initial_load"}})}setupPageVisibilityTracking(){document.addEventListener("visibilitychange",()=>{const t=!document.hidden;this.isPageVisible=t,t?(this.addEvent({type:"page_focus",timestamp:Date.now()}),this.resetInactivityTimer()):(this.addEvent({type:"page_blur",timestamp:Date.now()}),this.clearInactivityTimer())}),window.addEventListener("focus",()=>{this.isPageVisible||(this.isPageVisible=!0,this.addEvent({type:"page_focus",timestamp:Date.now(),details:{source:"window_focus"}}))}),window.addEventListener("blur",()=>{this.isPageVisible&&(this.isPageVisible=!1,this.addEvent({type:"page_blur",timestamp:Date.now(),details:{source:"window_blur"}}))})}setupInactivityTracking(){this.resetInactivityTimer()}setupInteractionTracking(){["click","mousemove","scroll","keypress","touchstart"].forEach(t=>{document.addEventListener(t,e=>{this.recordInteraction(t,e)},{passive:!0})})}recordInteraction(t,e){if(!this.isPageVisible||!this.consentGiven)return;const n=Date.now();if(this.lastActivity=n,this.isActive||this.setActiveState(!0),"mousemove"===t){if(this.lastMouseMove&&500>n-this.lastMouseMove)return;this.lastMouseMove=n}if("scroll"===t){if(this.lastScroll&&200>n-this.lastScroll)return;this.lastScroll=n}this.addEvent({type:"interaction",timestamp:n,details:{interactionType:t,x:e.clientX||0,y:e.clientY||0}}),this.resetInactivityTimer()}setActiveState(t){if(this.isActive!==t){const e=Date.now(),n=e-this.currentStreak.start;"active"===this.currentStreak.type?this.stats.longestActiveStreak=Math.max(this.stats.longestActiveStreak,n):this.stats.longestInactiveStreak=Math.max(this.stats.longestInactiveStreak,n),this.isActive=t,this.currentStreak={type:t?"active":"inactive",start:e},this.addEvent({type:t?"active":"inactive",timestamp:e,duration:n})}}resetInactivityTimer(){this.clearInactivityTimer(),this.isPageVisible&&(this.inactivityTimer=setTimeout(()=>{this.setActiveState(!1)},this.INACTIVITY_THRESHOLD))}clearInactivityTimer(){this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)}addEvent(t){const e={id:`event_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,...t};this.events.push(e),this.events.length>1e3&&(this.events=this.events.slice(-1e3)),this.updateStats()}updateStats(){const t=Date.now()-this.sessionStart;let e=0,n=0,s=0,i=0;this.createTimeBlocks().forEach(t=>{const i=t.endTime-t.startTime;switch(t.type){case"active":e+=i;break;case"inactive":n+=i;break;case"away":s+=i}}),i=this.events.filter(t=>"interaction"===t.type).length,this.stats={totalTimeOnPage:t,activeTime:e,inactiveTime:n,awayTime:s,totalInteractions:i,longestActiveStreak:this.stats.longestActiveStreak,longestInactiveStreak:this.stats.longestInactiveStreak,averageSessionLength:t},this.updateStatsUI()}createTimeBlocks(){if(0===this.events.length){const t=Date.now();return[{startTime:this.sessionStart,endTime:t,type:this.isActive?"active":"inactive",duration:t-this.sessionStart}]}const t=[...this.events].sort((t,e)=>t.timestamp-e.timestamp),e=[];let n=this.sessionStart,s="active";for(let i=0;i<t.length;i++){const a=t[i];t[i+1];let r=s;"inactive"===a.type?r="inactive":"page_blur"===a.type?r="away":"active"!==a.type&&"interaction"!==a.type&&"page_focus"!==a.type||(r="active"),r!==s&&(e.push({startTime:n,endTime:a.timestamp,type:s,duration:a.timestamp-n}),n=a.timestamp,s=r)}const i=Date.now();return e.push({startTime:n,endTime:i,type:this.isPageVisible?this.isActive?"active":"inactive":"away",duration:i-n}),e}startStatsUpdater(){setInterval(()=>{this.updateStats(),this.updateIntelligenceSummary()},1e3)}updateStatsUI(){document.getElementById("activitySummary")&&this.renderSummary();const t=document.getElementById("activityPanel");t&&!t.classList.contains("hidden")&&(this.renderMetrics(),this.renderVisualTimeline(),this.renderTimeline())}setupEventListeners(){const t=document.getElementById("toggleActivityPanel"),e=document.getElementById("clearActivityData"),n=document.getElementById("toggleDetailedHistory");t&&t.addEventListener("click",()=>this.togglePanel()),e&&e.addEventListener("click",()=>this.clearData()),n&&n.addEventListener("click",()=>this.toggleDetailedHistory());const s=document.getElementById("toggleIntelligencePanel"),i=document.getElementById("exportIntelligence");s&&s.addEventListener("click",()=>this.toggleIntelligencePanel()),i&&i.addEventListener("click",()=>this.exportIntelligenceData())}togglePanel(){const t=document.getElementById("activityPanel"),e=document.getElementById("activityBtnText"),n=document.getElementById("toggleActivityPanel");t&&(t.classList.contains("hidden")?(t.classList.remove("hidden"),e&&(e.textContent="Ocultar Timeline"),n&&n.classList.add("active"),this.renderMetrics(),this.renderVisualTimeline(),this.renderTimeline()):(t.classList.add("hidden"),e&&(e.textContent="Ver Timeline"),n&&n.classList.remove("active")))}toggleDetailedHistory(){const t=document.getElementById("timelineContainer"),e=document.getElementById("detailToggleIcon");t&&e&&(this.detailedHistoryVisible=!this.detailedHistoryVisible,this.detailedHistoryVisible?(t.style.display="block",t.classList.remove("hidden"),t.classList.add("timeline-expanding"),t.classList.remove("timeline-collapsing"),t.offsetHeight,t.style.maxHeight="16rem",t.style.overflowY="auto",t.style.overflowX="hidden",t.style.opacity="1",e.className="fas fa-chevron-up text-xs",e.style.transform="rotate(0deg)",setTimeout(()=>{(0===t.children.length||this.needsTimelineUpdate)&&this.renderTimeline()},150)):(t.classList.add("timeline-collapsing"),t.classList.remove("timeline-expanding"),t.style.maxHeight="0",t.style.overflowY="hidden",t.style.opacity="0",e.className="fas fa-chevron-down text-xs",e.style.transform="rotate(0deg)",setTimeout(()=>{this.detailedHistoryVisible||(t.style.display="none")},300)))}clearData(){this.events=[],this.stats={totalTimeOnPage:0,activeTime:0,inactiveTime:0,awayTime:0,totalInteractions:0,longestActiveStreak:0,longestInactiveStreak:0,averageSessionLength:0},this.sessionStart=Date.now(),this.currentStreak={type:"active",start:Date.now()},this.updateStatsUI(),window.cvApp&&window.cvApp.showSuccess("Datos de actividad limpiados")}renderMetrics(){const t=document.getElementById("activityMetrics");if(!t)return;const e=t=>{const e=Math.floor(t/1e3),n=Math.floor(e/60),s=Math.floor(n/60);return s>0?`${s}h ${n%60}m`:n>0?`${n}m ${e%60}s`:e+"s"},n=this.stats.totalTimeOnPage>0?this.stats.activeTime/this.stats.totalTimeOnPage*100:0,s=this.stats.totalTimeOnPage>0?this.stats.inactiveTime/this.stats.totalTimeOnPage*100:0,i=this.stats.totalTimeOnPage>0?this.stats.awayTime/this.stats.totalTimeOnPage*100:0;t.innerHTML=`\n            \x3c!-- Tiempo Total --\x3e\n            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">\n                <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">${e(this.stats.totalTimeOnPage)}</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Tiempo Total</div>\n            </div>\n            \n            \x3c!-- Tiempo Activo --\x3e\n            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">\n                <div class="text-2xl font-bold text-green-600 dark:text-green-400">${Math.round(n)}%</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Activo</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400">${e(this.stats.activeTime)}</div>\n            </div>\n            \n            \x3c!-- Tiempo Inactivo --\x3e\n            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">\n                <div class="text-2xl font-bold text-orange-600 dark:text-orange-400">${Math.round(s)}%</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Inactivo</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400">${e(this.stats.inactiveTime)}</div>\n            </div>\n            \n            \x3c!-- Tiempo Fuera --\x3e\n            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 text-center">\n                <div class="text-2xl font-bold text-red-600 dark:text-red-400">${Math.round(i)}%</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">Fuera</div>\n                <div class="text-xs text-gray-500 dark:text-gray-400">${e(this.stats.awayTime)}</div>\n            </div>\n        `}renderVisualTimeline(){const t=document.getElementById("visualTimelineContainer");if(!t)return;const e=this.getTimeBlocks(),n=Date.now(),s=n-this.sessionStart;if(0===e.length||0===s)return void(t.innerHTML='<div class="text-center text-gray-500 dark:text-gray-400 py-4">Iniciando timeline...</div>');const i=t=>new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),a=t=>{const e=Math.floor(t/1e3),n=Math.floor(e/60);return n>0?`${n}m ${e%60}s`:e+"s"},r=e.map((t,n)=>{const r=Math.max(t.duration/s*100,.5),o=(t=>{switch(t){case"active":return"bg-green-500";case"inactive":return"bg-orange-500";case"away":return"bg-red-500";default:return"bg-gray-500"}})(t.type),l=n===e.length-1;return`\n                <div class="timeline-block ${o} ${l?"current":""} transition-all duration-300 hover:opacity-80 cursor-pointer" \n                     style="width: ${r}%; height: 24px; min-width: 2px;"\n                     title="${"active"===t.type?"Activo":"inactive"===t.type?"Inactivo":"Fuera"}: ${a(t.duration)} (${i(t.startTime)} - ${i(t.endTime)})"\n                     data-block-info="${JSON.stringify({type:t.type,duration:a(t.duration),start:i(t.startTime),end:i(t.endTime),isCurrent:l}).replace(/"/g,"&quot;")}">\n                </div>\n            `}).join(""),o=a(s),l=i(this.sessionStart),d=i(n);t.innerHTML=`\n            <div class="mb-3">\n                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-2">\n                    <span>${l}</span>\n                    <span class="font-medium">Sesión: ${o}</span>\n                    <span>${d}</span>\n                </div>\n                <div class="flex rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600 shadow-sm">\n                    ${r}\n                </div>\n            </div>\n            <div id="timelineTooltip" class="hidden absolute bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded px-2 py-1 pointer-events-none z-50 shadow-lg">\n                \x3c!-- Tooltip content --\x3e\n            </div>\n        `;const c=t.querySelectorAll(".timeline-block"),h=t.querySelector("#timelineTooltip");c.forEach(t=>{t.addEventListener("mouseenter",t=>{if(h){const e=JSON.parse(t.target.getAttribute("data-block-info").replace(/&quot;/g,'"')),n="active"===e.type?"Activo":"inactive"===e.type?"Inactivo":"Fuera",s=e.isCurrent?' <span class="text-yellow-300">●</span>':"";h.innerHTML=`\n                        <div class="font-semibold">${n}${s}</div>\n                        <div>${e.duration}</div>\n                        <div class="text-xs opacity-75">${e.start} - ${e.end}</div>\n                        ${e.isCurrent?'<div class="text-xs text-yellow-300 mt-1">Bloque actual</div>':""}\n                    `,h.classList.remove("hidden")}}),t.addEventListener("mouseleave",()=>{h&&h.classList.add("hidden")}),t.addEventListener("mousemove",t=>{h&&(h.style.left=t.pageX+10+"px",h.style.top=t.pageY-10+"px")})})}renderTimeline(){const t=document.getElementById("timelineContainer");if(!t)return;const e=this.getTimeBlocks(),n=Date.now()-this.sessionStart;if(0===e.length)return void(t.innerHTML='\n                <div class="text-center text-gray-500 dark:text-gray-400 py-4">\n                    <i class="fas fa-clock mb-2"></i>\n                    <div>No hay datos de timeline aún</div>\n                    <div class="text-xs mt-1">Interactúa con la página para generar datos</div>\n                </div>\n            ');const s=t=>new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),i=t=>{switch(t){case"active":return"bg-green-500";case"inactive":return"bg-orange-500";case"away":return"bg-red-500";default:return"bg-gray-500"}},a=e;t.innerHTML=a.map((t,e)=>{const a=n>0?t.duration/n*100:0;return`\n                <div class="flex items-center space-x-3 py-2 hover:bg-white/50 dark:hover:bg-gray-700/50 rounded-lg px-2 transition-colors">\n                    <div class="flex-shrink-0">\n                        <div class="w-8 h-8 ${i(t.type)} rounded-full flex items-center justify-center">\n                            <i class="${(t=>{switch(t){case"active":return"fas fa-play";case"inactive":return"fas fa-pause";case"away":return"fas fa-eye-slash";default:return"fas fa-circle"}})(t.type)} text-white text-xs"></i>\n                        </div>\n                    </div>\n                    <div class="flex-1 min-w-0">\n                        <div class="flex items-center justify-between">\n                            <div class="text-sm font-medium text-gray-900 dark:text-gray-100 capitalize">\n                                ${"active"===t.type?"Activo":"inactive"===t.type?"Inactivo":"Fuera"}\n                            </div>\n                            <div class="text-xs text-gray-500 dark:text-gray-400">\n                                ${s(t.startTime)} - ${s(t.endTime)}\n                            </div>\n                        </div>\n                        <div class="flex items-center space-x-2 mt-1">\n                            <div class="flex-1 bg-gray-200 dark:bg-gray-600 rounded-full h-2">\n                                <div class="${i(t.type)} h-2 rounded-full transition-all duration-300" \n                                     style="width: ${Math.max(a,2)}%"></div>\n                            </div>\n                            <div class="text-xs text-gray-500 dark:text-gray-400 min-w-0">\n                                ${(t=>{const e=Math.floor(t/1e3),n=Math.floor(e/60);return n>0?`${n}m ${e%60}s`:e+"s"})(t.duration)}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `}).join(""),setTimeout(()=>{t.scrollHeight>t.clientHeight?t.classList.add("scrollable"):t.classList.remove("scrollable")},100)}renderSummary(){const t=document.getElementById("activitySummary");if(!t)return;const e=this.stats.totalTimeOnPage>0?this.stats.activeTime/this.stats.totalTimeOnPage*100:0;let n="bg-green-500",s="Activo";this.isPageVisible?this.isActive||(n="bg-orange-500",s="Inactivo"):(n="bg-red-500",s="Fuera");const i=Date.now()-this.lastActivity,a=Math.max(0,this.INACTIVITY_THRESHOLD-i);t.innerHTML=`\n            <div class="flex flex-col sm:flex-row sm:items-center space-y-1 sm:space-y-0 sm:space-x-2">\n                \x3c!-- Primera línea: Estado y tiempo total --\x3e\n                <div class="flex items-center space-x-2">\n                    <div class="w-3 h-3 rounded-full ${n} status-indicator"></div>\n                    <span class="text-sm font-medium">${s}</span>\n                    <span class="text-xs text-gray-500 hidden sm:inline">•</span>\n                    <span class="text-xs text-gray-500">${(t=>{const e=Math.floor(t/1e3),n=Math.floor(e/60),s=Math.floor(n/60);return s>0?`${s}h ${n%60}m`:n>0?`${n}m ${e%60}s`:e+"s"})(this.stats.totalTimeOnPage)} total</span>\n                </div>\n                \n                \x3c!-- Segunda línea en móvil, misma línea en desktop --\x3e\n                <div class="flex items-center space-x-2 text-xs text-gray-500 ml-5 sm:ml-0">\n                    <span class="hidden sm:inline">•</span>\n                    <span>${Math.round(e)}% activo</span>\n                    ${this.isActive&&this.isPageVisible&&a>0?`<span class="hidden sm:inline">•</span>\n                         <span class="text-gray-400 sm:ml-0">${Math.ceil(a/1e3)}s hasta inactivo</span>`:""}\n                </div>\n            </div>\n        `}getStats(){return{...this.stats}}getEvents(){return[...this.events]}getTimeBlocks(){return this.createTimeBlocks()}isCurrentlyActive(){return this.isActive&&this.isPageVisible}detectDevice(){const t=navigator.userAgent,e=window.screen;return{type:/Mobi|Android/i.test(t)?"mobile":/Tablet|iPad/i.test(t)?"tablet":"desktop",os:/Windows/i.test(t)?"Windows":/Mac/i.test(t)?"macOS":/Linux/i.test(t)?"Linux":/Android/i.test(t)?"Android":/iOS/i.test(t)?"iOS":"Unknown",screen:{width:e.width,height:e.height,viewport:{width:window.innerWidth,height:window.innerHeight}},pixelRatio:window.devicePixelRatio||1,touchCapable:"ontouchstart"in window}}detectBrowser(){const t=navigator.userAgent,e=navigator;return{name:/Chrome/i.test(t)&&!/Edge/i.test(t)?"Chrome":/Firefox/i.test(t)?"Firefox":/Safari/i.test(t)&&!/Chrome/i.test(t)?"Safari":/Edge/i.test(t)?"Edge":"Other",version:this.getBrowserVersion(t),language:e.language||e.userLanguage,languages:e.languages||[e.language],cookieEnabled:e.cookieEnabled,onLine:e.onLine,platform:e.platform,hardwareConcurrency:e.hardwareConcurrency||"unknown"}}detectLocale(){const t=new Date;return{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,languages:navigator.languages||[navigator.language],locale:Intl.DateTimeFormat().resolvedOptions().locale,timeFormat:t.toLocaleTimeString(),dateFormat:t.toLocaleDateString(),currency:this.detectCurrency(),rtl:"rtl"===document.dir||"rtl"===getComputedStyle(document.body).direction}}getBrowserVersion(t){let e="Unknown";const n=[{name:"Chrome",pattern:/Chrome\/([0-9.]+)/},{name:"Firefox",pattern:/Firefox\/([0-9.]+)/},{name:"Safari",pattern:/Version\/([0-9.]+).*Safari/},{name:"Edge",pattern:/Edge\/([0-9.]+)/}];for(let s of n){const n=t.match(s.pattern);if(n){e=n[1];break}}return e}detectCurrency(){try{const t=navigator.language;return new Intl.NumberFormat(t,{style:"currency",currency:"USD"}).resolvedOptions().currency}catch(t){return"USD"}}setupSectionTracking(){if(!this.consentGiven)return;const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&t.intersectionRatio>.3&&this.trackSectionEnter(t.target.id)})},{threshold:[.1,.3,.5,.7],rootMargin:"-10px 0px -10px 0px"});["hero","about","experience","education","skills","projects","languages","contact"].forEach(e=>{const n=document.getElementById(e);n&&t.observe(n)}),setTimeout(()=>{const t=document.getElementById("hero");if(t){const e=t.getBoundingClientRect();e.top<window.innerHeight&&e.bottom>0&&this.trackSectionEnter("hero")}},1e3),this.setupScrollAnalytics()}trackSectionEnter(t){if(!this.consentGiven)return;const e=Date.now();if(this.currentSection===t)return;if(this.currentSection&&this.sectionStartTime){const t=e-this.sectionStartTime,n=(this.sectionVisits.get(this.currentSection)||0)+t;this.sectionVisits.set(this.currentSection,n),this.addEvent({type:"section_exit",timestamp:e,details:{section:this.currentSection,timeSpent:t,totalTime:n}})}this.currentSection=t,this.sectionStartTime=e;const n=this.userProfile.behavior.navigationPattern[this.userProfile.behavior.navigationPattern.length-1];n&&n.section===t||this.userProfile.behavior.navigationPattern.push({section:t,timestamp:e,order:this.userProfile.behavior.navigationPattern.length+1}),this.addEvent({type:"section_enter",timestamp:e,details:{section:t}}),this.updateFavoriteSection()}setupScrollAnalytics(){if(!this.consentGiven)return;let t,e={lastY:window.scrollY,lastTime:Date.now(),speeds:[],pauses:0,direction:"down",totalDistance:0};window.addEventListener("scroll",()=>{if(!this.consentGiven)return;const n=Date.now(),s=window.scrollY,i=n-e.lastTime,a=Math.abs(s-e.lastY);if(i>50){const t=a/i;e.speeds.push(t),e.totalDistance+=a,e.direction=s>e.lastY?"down":"up",e.lastY=s,e.lastTime=n,e.speeds.length>20&&e.speeds.shift()}clearTimeout(t),t=setTimeout(()=>{e.pauses++,this.addEvent({type:"scroll_pause",timestamp:Date.now(),details:{position:window.scrollY,section:this.currentSection,duration:1e3}})},1e3)}),setInterval(()=>{e.speeds.length>0&&this.analyzeReadingBehavior(e)},3e3)}analyzeReadingBehavior(t){if(!this.consentGiven)return;const e=t.speeds.reduce((t,e)=>t+e,0)/t.speeds.length,n=Date.now()-this.sessionStart,s=t.pauses/(n/6e4);let i="reader";e>1.5&&3>s?i="scanner":.8>e&&s>4&&(i="explorer");const a=this.userProfile.behavior.readingType;this.userProfile.preferences.readingSpeed=e,this.userProfile.behavior.readingType=i;const r=this.calculateEngagement();this.userProfile.preferences.engagementLevel,this.userProfile.preferences.engagementLevel=r>.6?"high":r>.3?"medium":"low",a!==i||this.userProfile.preferences.engagementLevel}calculateEngagement(){if(!this.consentGiven)return 0;const t=Math.max(Date.now()-this.sessionStart,1e3),e=this.getStats(),n=Math.max(e.sessionLength||0,0),s=this.sectionVisits.size,i=this.events.filter(t=>["click","mousemove","keypress"].includes(t.type)).length;if(0===t||isNaN(t))return 0;const a=.4*Math.min(Math.max(n/t,0),1)+.3*Math.min(Math.max(s/8,0),1)+.3*Math.min(Math.max(i/20,0),1);return isNaN(a)?0:Math.max(0,Math.min(1,a))}updateFavoriteSection(){if(!this.consentGiven||0===this.sectionVisits.size)return;let t=0,e=null;this.sectionVisits.forEach((n,s)=>{n>t&&(t=n,e=s)}),this.userProfile.behavior.favoriteSection,this.userProfile.behavior.favoriteSection=e}getUserInsights(){return this.consentGiven?(this.updateFavoriteSection(),this.getStats(),{profile:this.userProfile,sections:Object.fromEntries(this.sectionVisits),insights:{mostInterested:this.userProfile.behavior.favoriteSection,readingStyle:this.userProfile.behavior.readingType,engagement:this.userProfile.preferences.engagementLevel,sessionQuality:this.calculateEngagement(),preferredContent:this.getPreferredContent(),visitPattern:this.getVisitPattern()},technical:{performanceScore:this.calculatePerformanceScore(),browserOptimized:this.isBrowserOptimized(),accessibilityScore:this.calculateAccessibilityScore()}}):null}getPreferredContent(){const t=Object.fromEntries(this.sectionVisits);return Object.entries(t).sort(([,t],[,e])=>e-t).slice(0,3).map(([t])=>t)}getVisitPattern(){const t=this.userProfile.behavior.navigationPattern,e=["hero","about","experience","education","skills","projects","languages","contact"];return{type:t.every((n,s)=>0===s||e.indexOf(n.section)>=e.indexOf(t[s-1].section))?"linear":"exploratory",jumps:t.length-new Set(t.map(t=>t.section)).size,totalSections:new Set(t.map(t=>t.section)).size,pattern:t.map(t=>t.section)}}calculatePerformanceScore(){const t=navigator.connection||navigator.mozConnection||navigator.webkitConnection,e=t?(t.downlink||10)/100:.1;return Math.min(.7+e,1)}isBrowserOptimized(){const t=this.userProfile.browser;return["Chrome","Firefox","Safari","Edge"].includes(t.name)}calculateAccessibilityScore(){let t=.8;return window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(t+=.1),window.matchMedia("(prefers-contrast: high)").matches&&(t+=.05),window.matchMedia("(prefers-font-size: large)").matches&&(t+=.05),Math.min(t,1)}toggleIntelligencePanel(){const t=document.getElementById("intelligencePanel"),e=document.getElementById("toggleIntelligencePanel");t&&(t.classList.contains("hidden")?(t.classList.remove("hidden"),e&&(e.classList.add("active"),e.innerHTML='<i class="fas fa-analytics text-sm"></i><span>Ocultar Análisis</span>'),this.renderIntelligenceDashboard()):(t.classList.add("hidden"),e&&(e.classList.remove("active"),e.innerHTML='<i class="fas fa-analytics text-sm"></i><span>Ver Análisis Completo</span>'),this.intelligenceDashboardActive=!1))}renderIntelligenceDashboard(){if(!this.consentGiven)return;const t=this.getUserInsights();t&&(this.renderIntelligenceSummary(t),this.renderTechnicalProfile(t.profile),this.renderBehavioralProfile(t),this.renderContentAnalysis(t),this.renderReadingPatterns(t),this.intelligenceDashboardActive=!0)}renderIntelligenceSummary(t){const e=document.getElementById("intelligenceSummary");if(!e||!t)return;const{profile:n,insights:s}=t,i=s.engagement,a=s.readingStyle,r=s.mostInterested||"hero",o="high"===i?"text-green-600":"medium"===i?"text-yellow-600":"text-red-600",l="high"===i?"fas fa-fire":"medium"===i?"fas fa-thumbs-up":"fas fa-meh",d=(new Date).toLocaleTimeString(),c=document.getElementById("intelligencePanel"),h=c&&!c.classList.contains("hidden")?`<div class="flex items-center space-x-1 text-xs text-green-600 dark:text-green-400">\n                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>\n                <span>Actualizando • ${d}</span>\n            </div>`:"";e.innerHTML=`\n            <div class="flex flex-col sm:flex-row sm:items-center justify-between space-y-2 sm:space-y-0">\n                <div class="flex items-center space-x-3">\n                    <i class="${l} ${o} text-lg"></i>\n                    <div>\n                        <span class="font-medium text-gray-900 dark:text-gray-100">\n                            ${this.getEngagementDescription(i)}\n                        </span>\n                        <div class="text-xs text-gray-500 dark:text-gray-400">\n                            Navegador: ${n.browser.name} • ${n.device.type} • ${n.locale.timezone}\n                        </div>\n                        ${h}\n                    </div>\n                </div>\n                <div class="text-right">\n                    <div class="text-sm font-medium text-gray-700 dark:text-gray-300">\n                        Sección favorita: ${this.getSectionDisplayName(r)}\n                    </div>\n                    <div class="text-xs text-gray-500 dark:text-gray-400">\n                        Estilo: ${this.getReadingStyleDescription(a)}\n                    </div>\n                </div>\n            </div>\n        `}renderTechnicalProfile(t){const e=document.getElementById("technicalProfile");e&&t&&(e.innerHTML=`\n            <div class="space-y-2">\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Sistema:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.device.os}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Navegador:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.browser.name} ${t.browser.version}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Resolución:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.device.screen.width}×${t.device.screen.height}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Viewport:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.device.screen.viewport.width}×${t.device.screen.viewport.height}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Idioma:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.locale.language}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Zona horaria:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.locale.timezone}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Touch:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${t.device.touchCapable?"Sí":"No"}</span>\n                </div>\n            </div>\n        `)}renderBehavioralProfile(t){const e=document.getElementById("behavioralProfile");if(!e||!t)return;const{insights:n,profile:s}=t,i=isNaN(n.sessionQuality)?0:Math.round(100*(n.sessionQuality||0)),a=n.visitPattern||{type:"linear",totalSections:0};e.innerHTML=`\n            <div class="space-y-2">\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Estilo de lectura:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${this.getReadingStyleDescription(n.readingStyle)}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Engagement:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${this.getEngagementDescription(n.engagement)}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Calidad de sesión:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${i}%</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Patrón de navegación:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${"linear"===a.type?"Lineal":"Exploratorio"}</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Secciones visitadas:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${a.totalSections}/8</span>\n                </div>\n                <div class="flex justify-between items-center">\n                    <span class="text-gray-600 dark:text-gray-400">Velocidad promedio:</span>\n                    <span class="font-medium text-gray-900 dark:text-gray-100">${s.preferences.readingSpeed.toFixed(2)} px/ms</span>\n                </div>\n            </div>\n        `}renderContentAnalysis(t){const e=document.getElementById("contentAnalysis");if(!e||!t)return;const{sections:n,insights:s}=t,i=s.preferredContent||[],a=Object.values(n).reduce((t,e)=>t+e,0);let r="";r=i.length>0&&a>1e3?i.map((t,e)=>{const s=n[t]||0,i=a>0?Math.round(s/a*100):0,r=this.getSectionDisplayName(t);return`\n                    <div class="flex items-center justify-between p-2 bg-white/50 dark:bg-gray-800/50 rounded">\n                        <div class="flex items-center space-x-2">\n                            <i class="${this.getSectionIcon(t)} text-${this.getSectionColor(t)}-500 text-sm"></i>\n                            <span class="text-sm font-medium text-gray-900 dark:text-gray-100">${r}</span>\n                        </div>\n                        <div class="text-right">\n                            <div class="text-sm font-medium text-gray-900 dark:text-gray-100">${i}%</div>\n                            <div class="text-xs text-gray-500 dark:text-gray-400">${this.formatDuration(s)}</div>\n                        </div>\n                    </div>\n                `}).join(""):'<div class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">Aún recopilando datos de interés...</div>',e.innerHTML=r}renderReadingPatterns(t){const e=document.getElementById("readingPatterns");if(!e||!t)return;const{profile:n,insights:s}=t,i=n.preferences.readingSpeed,a=s.visitPattern;this.analyzeScrollBehavior(),e.innerHTML=`\n            <div class="space-y-3">\n                <div class="flex items-center justify-between p-2 bg-white/50 dark:bg-gray-800/50 rounded">\n                    <div class="flex items-center space-x-2">\n                        <i class="fas fa-tachometer-alt text-blue-500 text-sm"></i>\n                        <span class="text-sm text-gray-700 dark:text-gray-300">Velocidad de scroll</span>\n                    </div>\n                    <span class="text-sm font-medium text-gray-900 dark:text-gray-100">\n                        ${this.getSpeedDescription(i)}\n                    </span>\n                </div>\n                <div class="flex items-center justify-between p-2 bg-white/50 dark:bg-gray-800/50 rounded">\n                    <div class="flex items-center space-x-2">\n                        <i class="fas fa-route text-green-500 text-sm"></i>\n                        <span class="text-sm text-gray-700 dark:text-gray-300">Navegación</span>\n                    </div>\n                    <span class="text-sm font-medium text-gray-900 dark:text-gray-100">\n                        ${"linear"===a.type?"Secuencial":"Exploratoria"}\n                    </span>\n                </div>\n                <div class="flex items-center justify-between p-2 bg-white/50 dark:bg-gray-800/50 rounded">\n                    <div class="flex items-center space-x-2">\n                        <i class="fas fa-mouse-pointer text-purple-500 text-sm"></i>\n                        <span class="text-sm text-gray-700 dark:text-gray-300">Interacciones</span>\n                    </div>\n                    <span class="text-sm font-medium text-gray-900 dark:text-gray-100">\n                        ${this.events.filter(t=>["click","mousemove"].includes(t.type)).length} registradas\n                    </span>\n                </div>\n                <div class="flex items-center justify-between p-2 bg-white/50 dark:bg-gray-800/50 rounded">\n                    <div class="flex items-center space-x-2">\n                        <i class="fas fa-pause text-orange-500 text-sm"></i>\n                        <span class="text-sm text-gray-700 dark:text-gray-300">Pausas de scroll</span>\n                    </div>\n                    <span class="text-sm font-medium text-gray-900 dark:text-gray-100">\n                        ${this.events.filter(t=>"scroll_pause"===t.type).length} detectadas\n                    </span>\n                </div>\n            </div>\n        `}exportIntelligenceData(){if(!this.consentGiven)return void alert("No hay datos disponibles para exportar. Acepta el tracking primero.");const t=this.getUserInsights();if(!t)return void alert("No hay suficientes datos para exportar aún.");const e={timestamp:(new Date).toISOString(),insights:t,rawData:{events:this.getEvents(),stats:this.getStats(),sections:Object.fromEntries(this.sectionVisits)}},n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=`user-intelligence-${(new Date).getTime()}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}getEngagementDescription(t){return{high:"Muy comprometido",medium:"Moderadamente interesado",low:"Navegación superficial"}[t]||"Analizando..."}getReadingStyleDescription(t){return{scanner:"Scanner rápido",reader:"Lector detallado",explorer:"Explorador minucioso"}[t]||"Analizando..."}getSectionDisplayName(t){return{hero:"Inicio",about:"Sobre mí",experience:"Experiencia",education:"Educación",skills:"Habilidades",projects:"Proyectos",languages:"Idiomas",contact:"Contacto"}[t]||t}getSectionIcon(t){return{hero:"fas fa-home",about:"fas fa-user",experience:"fas fa-briefcase",education:"fas fa-graduation-cap",skills:"fas fa-cogs",projects:"fas fa-code",languages:"fas fa-language",contact:"fas fa-envelope"}[t]||"fas fa-circle"}getSectionColor(t){return{hero:"blue",about:"green",experience:"purple",education:"indigo",skills:"yellow",projects:"red",languages:"pink",contact:"gray"}[t]||"gray"}getSpeedDescription(t){return.5>t?"Muy lenta":1>t?"Lenta":2>t?"Normal":4>t?"Rápida":"Muy rápida"}analyzeScrollBehavior(){return{averageSpeed:this.userProfile.preferences.readingSpeed,pauseFrequency:this.events.filter(t=>"scroll_pause"===t.type).length,totalDistance:0}}formatDuration(t){return 1e3>t?Math.round(t)+"ms":6e4>t?Math.round(t/1e3)+"s":Math.round(t/6e4)+"m"}updateIntelligenceSummary(){if(!this.consentGiven)return;const t=this.getUserInsights();if(!t)return;document.getElementById("intelligenceSummary")&&this.renderIntelligenceSummary(t);const e=document.getElementById("intelligencePanel");e&&!e.classList.contains("hidden")&&(this.renderTechnicalProfile(t.profile),this.renderBehavioralProfile(t),this.renderContentAnalysis(t),this.renderReadingPatterns(t))}}class HeatmapTracker{constructor(){this.interactions=[],this.isVisible=!1,this.canvas=null,this.ctx=null,this.consentGiven=!1,this.init()}init(){this.canvas=document.getElementById("heatmapCanvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"),this.setupCanvas(),this.setupEventListeners(),this.startTracking(),this.updateStats(),this.addTestPoints())}addTestPoints(){setTimeout(()=>{this.addInteraction(200,200,"click"),this.addInteraction(400,800,"click"),this.addInteraction(600,1500,"click"),this.addInteraction(300,2e3,"click"),this.addInteraction(100,300,"move"),this.addInteraction(500,1200,"move")},1e3)}setupCanvas(){this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),window.addEventListener("scroll",()=>{this.isVisible&&this.renderVisibleInteractions()})}resizeCanvas(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=document.documentElement.scrollHeight)}setupEventListeners(){const t=document.getElementById("toggleHeatmap"),e=document.getElementById("clearHeatmap");t&&t.addEventListener("click",()=>this.toggleVisibility()),e&&e.addEventListener("click",()=>this.clearData())}startTracking(){let t,e;document.addEventListener("mousemove",e=>{this.consentGiven&&!t&&(t=setTimeout(()=>{const n=e.clientY+window.scrollY;this.addInteraction(e.clientX,n,"move"),t=null},50))}),document.addEventListener("click",t=>{if(!this.consentGiven)return;const e=t.clientY+window.scrollY;this.addInteraction(t.clientX,e,"click")}),window.addEventListener("scroll",()=>{e||(e=setTimeout(()=>{const t=window.innerWidth/2,n=window.scrollY+window.innerHeight/2;this.addInteraction(t,n,"scroll"),e=null},100))})}addInteraction(t,e,n,s){const i="click"===n?50:"scroll"===n?35:25,a="click"===n?.6:"scroll"===n?.15:.05;this.interactions.push({x:t,y:e,type:n,radius:i,intensity:a,timestamp:Date.now()}),this.interactions.length>1e3&&(this.interactions=this.interactions.slice(-1e3)),this.updateStats(),this.isVisible&&this.drawPoint(t,e,i,a)}toggleVisibility(){this.isVisible=!this.isVisible;const t=document.getElementById("heatmapBtnText"),e=document.getElementById("toggleHeatmap"),n=this.canvas;this.isVisible?(n.classList.remove("hidden"),n.style.display="block",setTimeout(()=>{this.resizeCanvas(),this.renderAllInteractions()},100),t&&(t.textContent="Ocultar Heatmap"),e&&e.classList.add("active")):(n.classList.add("hidden"),n.style.display="none",this.clearCanvas(),t&&(t.textContent="Mostrar Heatmap"),e&&e.classList.remove("active"))}renderAllInteractions(){this.clearCanvas(),this.interactions.forEach((t,e)=>{this.drawPoint(t.x,t.y,t.radius,t.intensity)})}renderVisibleInteractions(){this.renderAllInteractions()}drawPoint(t,e,n,s){if(!this.ctx)return;0>t||0>e||t>this.canvas.width||this.canvas.height,this.ctx.globalCompositeOperation="source-over";const i=this.ctx.createRadialGradient(t,e,0,t,e,n),a="255,0,0";i.addColorStop(0,`rgba(${a},${Math.min(3*s,.8)})`),i.addColorStop(.5,`rgba(${a},${Math.min(1.5*s,.4)})`),i.addColorStop(1,`rgba(${a},0)`),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(t,e,n,0,2*Math.PI),this.ctx.fill()}clearCanvas(){this.ctx&&this.canvas&&this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}clearData(){this.interactions=[],this.clearCanvas(),this.updateStats(),window.cvApp&&window.cvApp.showSuccess("Datos del heatmap limpiados")}updateStats(){const t=document.getElementById("interactionCount");if(!t)return;const e=this.interactions.filter(t=>"click"===t.type).length,n=this.interactions.filter(t=>"move"===t.type).length,s=this.interactions.filter(t=>"scroll"===t.type).length;t.textContent=`${e} clics, ${n} movimientos, ${s} scrolls registrados`}getAnalytics(){const t=Date.now(),e=this.interactions.filter(e=>3e5>t-e.timestamp);return{total:this.interactions.length,recent:e.length,byType:{clicks:this.interactions.filter(t=>"click"===t.type).length,moves:this.interactions.filter(t=>"move"===t.type).length,scrolls:this.interactions.filter(t=>"scroll"===t.type).length},hotspots:this.calculateHotspots()}}calculateHotspots(){const t=100,e={};return this.interactions.forEach(n=>{const s=Math.floor(n.x/t),i=Math.floor(n.y/t),a=`${s},${i}`;e[a]||(e[a]={count:0,totalIntensity:0,x:s*t,y:i*t}),e[a].count++,e[a].totalIntensity+=n.intensity}),Object.values(e).sort((t,e)=>e.totalIntensity-t.totalIntensity).slice(0,5)}}"undefined"!=typeof module&&module.exports&&(module.exports=CVApp);